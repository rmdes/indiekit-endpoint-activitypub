{% extends "document.njk" %}

{% from "heading/macro.njk" import heading with context %}
{% from "input/macro.njk" import input with context %}
{% from "button/macro.njk" import button with context %}
{% from "checkboxes/macro.njk" import checkboxes with context %}
{% from "file-input/macro.njk" import fileInput with context %}
{% from "notification-banner/macro.njk" import notificationBanner with context %}
{% from "prose/macro.njk" import prose with context %}
{% from "badge/macro.njk" import badge with context %}

{% block content %}
  {{ heading({ text: title, level: 1, parent: { text: __("activitypub.title"), href: mountPath } }) }}

  {% if result %}
    {{ notificationBanner({ type: result.type, text: result.text }) }}
  {% endif %}

  {{ prose({ text: __("activitypub.migrate.intro") }) }}

  {# Step 1 — Actor alias #}
  {{ heading({ text: __("activitypub.migrate.step1Title"), level: 2 }) }}
  {{ prose({ text: __("activitypub.migrate.step1Desc") }) }}

  {% if currentAlias %}
    <p>
      <strong>{{ __("activitypub.migrate.aliasCurrent") }}:</strong>
      <a href="{{ currentAlias }}">{{ currentAlias }}</a>
    </p>
  {% else %}
    <p><em>{{ __("activitypub.migrate.aliasNone") }}</em></p>
  {% endif %}

  <form method="post" novalidate>
    <input type="hidden" name="action" value="alias">
    {{ input({
      name: "aliasUrl",
      label: __("activitypub.migrate.aliasLabel"),
      hint: __("activitypub.migrate.aliasHint"),
      value: currentAlias,
      type: "url"
    }) }}
    {{ button({ text: __("activitypub.migrate.aliasSave") }) }}
  </form>

  <hr>

  {# Step 2 — Import CSV #}
  {{ heading({ text: __("activitypub.migrate.step2Title"), level: 2 }) }}
  {{ prose({ text: __("activitypub.migrate.step2Desc") }) }}

  <form method="post" enctype="multipart/form-data" novalidate>
    <input type="hidden" name="action" value="import">

    {{ checkboxes({
      name: "importTypes",
      fieldset: {
        legend: __("activitypub.migrate.importLegend")
      },
      items: [
        {
          label: __("activitypub.migrate.importFollowing"),
          value: "following",
          hint: __("activitypub.migrate.importFollowingHint")
        },
        {
          label: __("activitypub.migrate.importFollowers"),
          value: "followers",
          hint: __("activitypub.migrate.importFollowersHint")
        }
      ],
      values: ["following"]
    }) }}

    {{ fileInput({
      name: "csvFile",
      label: __("activitypub.migrate.fileLabel"),
      hint: __("activitypub.migrate.fileHint"),
      accept: ".csv,.txt"
    }) }}

    {{ button({ text: __("activitypub.migrate.importButton") }) }}
  </form>

  <hr>

  {# Step 3 — Instructions #}
  {{ heading({ text: __("activitypub.migrate.step3Title"), level: 2 }) }}
  {{ prose({ text: __("activitypub.migrate.step3Desc") }) }}
{% endblock %}
